<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

	<!-- <insert id="insert" parameterType="boardvo">
		<![CDATA[
		insert
		  into board
		values (null, #{title }, #{contents }, #{hit }, now(), #{g_no }, #{o_no }, #{depth }, #{user_no } )
		
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			select last_insert_id()
		</selectKey>
		]]>
	</insert>


	<update id="update" parameterType="boardvo">
		<![CDATA[
			update board 
				set #{title } and #{contents } and now()
				where #{no }
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
			select last_insert_id()
			]]>
		</selectKey>
	</update>

	<delete id="delete" parameterType="boardvo">
		<![CDATA[
		delete from board
			where #{no }
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			select last_insert_id()
		</selectKey>
		]]>
	</delete>


	<update id="update" parameterType="boardvo">
		<![CDATA[
			update board set title = '삭제된 게시물입니다.'
				where (select count(*) 
				from (select * from board where #{g_no }) a) > 1 and #{no }
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			select last_insert_id()
		</selectKey>
		]]>
	</update> -->

	<select id="getList" resultType="boardvo">
		<![CDATA[
		  select b.no as no,
		  		b.title,
		        u.name as userName,
		        b.contents,
		        b.hit,
		        date_format(reg_date, '%Y-%m-%d %h:%i:%s') as regDate,
		        b.depth
	        from user u, board b
	        where u.no=b.user_no	
		order by b.g_no desc, b.o_no asc;
		]]>
	</select>


	<!-- <select id="getByNoList" resultType="boardvo">
		<![CDATA[
		  select u.no as userno,
		  		b.no as no,
		  		b.title,
		  		b.contents
	        from user u, board b
	        where u.no=b.user_no	
		order by #{b.no };
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			select last_insert_id()
		</selectKey>
		]]>
	</select> -->
	
	
	
	<select id="getByEmailAndPassword1" parameterType="uservo" resultType="uservo">
		<![CDATA[
		select no, name 
		  from user
		 where email = #{email }
		   and password = #{password }		
		]]>
	</select>
	
	
	

	<!-- <select id="getByListKey" resultType="boardvo"> <![CDATA[ select b.no 
		as no, b.title u.name, b.contents, b.hit date_format(reg_date, '%Y-%m-%d 
		%h:%i:%s') as regDate, b.depth, b.g_no from user u, board b where u.no=b.user_no 
		and (b.title like #{b.title } or b.contents like #{b.contents }) order by 
		b.g_no desc, b.o_no asc limit ; ]]> </select> -->


</mapper>